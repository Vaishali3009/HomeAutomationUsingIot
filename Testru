ESP Simulation Service â€“ Spring Boot SOAP Microservice

ğŸ“˜ Overview

This project simulates an ESP (Electronic Service Provider) backend using Spring Boot, Spring WS, and SOAP Web Services.
It supports two main operations:
	â€¢	âœ… Account Validation
	â€¢	âœ… Customer Retrieval

Each operation is implemented using:
	â€¢	WSDL/XSD-based SOAP
	â€¢	Schema validation
	â€¢	Static response XML templates
	â€¢	DOM/XPath-based dynamic field injection

â¸»

ğŸ“ Architecture Flow


-----

+---------------------------------------------+
|         SOAP Request (WSDL/XSD)             |
+---------------------------------------------+
                     |
              [ Soap Adapter ]
                     |
                     v
        +-----------------------------+
        | PaymentValidationPort       |<--------------------+
        +-----------------------------+                     |
                     |                                      |
        +-----------------------------+                     |
        | PaymentOrchestrator         |                     |
        +-----------------------------+                     |
                     |                                      |
        +-----------------------------+                     |
        | AccountValidationPort       |                     |
        +-----------------------------+                     |
                                                            |
        +-----------------------------+                     |
        | CustomerRetrievalPort       |<------------------+ |
        +-----------------------------+                   | |
                     |                                    | |
        +-----------------------------+                   | |
        | CustomerRetrievalOrchestrator|                  | |
        +-----------------------------+                   | |
                     |                                    | |
        +-----------------------------+                   | |
        | CustomerRetrievalService     |                  | |
        +-----------------------------+                   | |
                                                          | |
        +-------------------------------------------------+ |
        |     All logic flows through Soap Adapter â†’      | |
        |     appropriate Port â†’ Orchestrator â†’ Service    |<+
        +--------------------------------------------------+





â¸»

ğŸ“ Modules & Structure
com.rbs.bdd
â”œâ”€â”€ application
â”‚   â”œâ”€â”€ exception                 # Custom exception classes
â”‚   â”œâ”€â”€ port.in                  # Interfaces for input (SOAP Adapter)
â”‚   â”œâ”€â”€ port.out                 # Interfaces for output (Service layer)
â”‚   â””â”€â”€ service                  # Business logic for account validation & customer retrieval
â”œâ”€â”€ domain
â”‚   â””â”€â”€ enums                    # Enums and constants (namespaces, error types, paths)
â”œâ”€â”€ infrastructure
â”‚   â”œâ”€â”€ config                   # Spring WS configuration
â”‚   â”œâ”€â”€ entity                   # JPA Entities
â”‚   â”œâ”€â”€ repository               # Spring Data JPA Repos
â”‚   â””â”€â”€ soap
â”‚       â”œâ”€â”€ adapter              # SOAP endpoint adapter
â”‚       â””â”€â”€ interceptor          # Interceptors for schema validation and custom errors
â”œâ”€â”€ util                         # Utility classes (DOM, XPath, Validation)
â”œâ”€â”€ static-response              # Static success & error response XMLs
â””â”€â”€ static-request               # Static sample SOAP request XMLs

Features
	â€¢	âœ… SOAP Operations
	â€¢	/validateArrangementForPayment â€“ Account Validation
	â€¢	/retrievePrimaryCustomerForArr â€“ Customer Lookup
	â€¢	ğŸ“œ Schema Validation
	â€¢	PayloadValidatingInterceptor per operation/namespace
	â€¢	Handles invalid requests with dynamic SOAP fault response
	â€¢	ğŸ§  Business Rule Engine
	â€¢	Validates IBAN (22-digit, GB prefix, MOD97)
	â€¢	Validates UBAN (14-digit numeric, fails if GB prefix or bad checksum)
	â€¢	ğŸ” Static XML Response Handling
	â€¢	Static templates read from /static-response/
	â€¢	Fields like transactionId, timestamp, status, and message are modified dynamically
	â€¢	âŒ Error Handling
	â€¢	Injects <transactionId>, <systemId>, <timestamp> if missing
	â€¢	Removes <refRequestIds>, <systemNotification> selectively from response
	â€¢	ğŸ§ª JUnit Coverage
	â€¢	AccountValidationServiceTest
	â€¢	CustomerRetrievalServiceTest
	â€¢	SchemaValidationInterceptorTest (Account & Customer)
	â€¢	PaymentValidationSoapAdapterTest

â¸»

ğŸ§¬ Schemas & WSDLs

ğŸ“‚ Located in: src/main/resources/xsd
â”œâ”€â”€ account-validation/
â”‚   â””â”€â”€ ArrValidationForPaymentParameters.xsd
â”œâ”€â”€ customer-retrieval/
â”‚   â””â”€â”€ CustomerRetrievalForPaymentParameters.xsd
â””â”€â”€ shared/
    â”œâ”€â”€ PrimitiveDatatypes.xsd
    â””â”€â”€ ServiceDefinitions.xsd


â”œâ”€â”€ account-validation/
â”‚   â””â”€â”€ ArrValidationForPaymentParameters.xsd
â”œâ”€â”€ customer-retrieval/
â”‚   â””â”€â”€ CustomerRetrievalForPaymentParameters.xsd
â””â”€â”€ shared/
    â”œâ”€â”€ PrimitiveDatatypes.xsd
    â””â”€â”€ ServiceDefinitions.xsd

Published WSDLs:
	â€¢	/ws/ArrValidationForPayment.wsdl
	â€¢	/ws/CustomerRetrievalForPayment.wsdl

â¸»

ğŸ§ª Test Scenarios Covered


Scenario
Description
âœ… Valid IBAN
Returns expected static response with name, prefix
âŒ UBAN with GB prefix
Triggers ERR_UBAN_GB
âŒ UBAN < 14 digits
Triggers UBAN should be 14 digits
âŒ Invalid IBAN (not GB)
Triggers DB2 SQL Error
âŒ MOD97 failure
Triggers MOD97 failure for the IBAN
âŒ Schema validation failure
Custom fault with 500 response
âŒ Malformed XML
Spring WS default fault with 500
âœ… Missing fields
Dynamically removes response fields


Scenario
Description
âœ… Valid IBAN
Returns expected static response with name, prefix
âŒ UBAN with GB prefix
Triggers ERR_UBAN_GB
âŒ UBAN < 14 digits
Triggers UBAN should be 14 digits
âŒ Invalid IBAN (not GB)
Triggers DB2 SQL Error
âŒ MOD97 failure
Triggers MOD97 failure for the IBAN
âŒ Schema validation failure
Custom fault with 500 response
âŒ Malformed XML
Spring WS default fault with 500
âœ… Missing fields
Dynamically removes response fields



Run Tests
mvn clean test

Generate test coverage (Jacoco):
mvn clean verify



â¸»

ğŸ’¡ Sample Request (Account Validation)
<validateArrangementForPayment xmlns="http://com/rbsg/soa/C040PaymentManagement/ArrValidationForPayment/V01/">
  <arrangementIdentifier>
    <identifier>GB29NWBK60161331926801</identifier>
    <codeValue>InternationalBankAccountNumber</codeValue>
  </arrangementIdentifier>
  <requestIds>
    <transactionId>ESP-TXN-123</transactionId>
    <systemId>ESP</systemId>
  </requestIds>
</validateArrangementForPayment>


Technologies Used
	â€¢	Java 17
	â€¢	Spring Boot 3.x
	â€¢	Spring WS
	â€¢	JAXB (XML binding)
	â€¢	XPath / DOM
	â€¢	PostgreSQL
	â€¢	JUnit 5
	â€¢	Mockito
	â€¢	Maven

â¸»

ğŸ“Œ Contributor Notes
	â€¢	âœï¸ Extend enums ValidationErrorType, ErrorConstants to define more rules.
	â€¢	âœï¸ Modify /static-response/error-response.xml for new error messages.
	â€¢	âœï¸ Update repository queries to map new customer data.
	â€¢	âœï¸ Reuse ValidationUtils.validateAccount() for both services.
	â€¢	âœï¸ Add custom logic in AccountValidationService and CustomerRetrievalService.


