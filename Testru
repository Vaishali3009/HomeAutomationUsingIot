package com.rbs.bdd.application.service;

import com.rbs.bdd.application.port.out.RetrieveCustomerPort;
import com.rbsg.soa.c040paymentmanagement.customerretrievalforpayment.v01.RetrievePrimaryCustomerForArrRequest;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.ws.WebServiceMessage;

import static org.mockito.Mockito.*;

class CustomerRetrievalOrchestratorTest {

    private RetrieveCustomerPort retrieveCustomerPort;
    private CustomerRetrievalOrchestrator orchestrator;
    private RetrievePrimaryCustomerForArrRequest mockRequest;
    private WebServiceMessage mockMessage;

    @BeforeEach
    void setUp() {
        retrieveCustomerPort = mock(RetrieveCustomerPort.class);
        orchestrator = new CustomerRetrievalOrchestrator(retrieveCustomerPort);
        mockRequest = mock(RetrievePrimaryCustomerForArrRequest.class);
        mockMessage = mock(WebServiceMessage.class);
    }

    @Test
    void validateCustomerRetrieval_shouldDelegateToPorts() {
        // Act
        orchestrator.validateCustomerRetrieval(mockRequest, mockMessage);

        // Assert
        verify(retrieveCustomerPort).validateSchema(mockRequest);
        verify(retrieveCustomerPort).retrieveCustomer(mockRequest, mockMessage);
    }
}
