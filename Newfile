package com.rbs.bdd.infrastructure.soap.api;

import com.rbs.bdd.application.port.in.CustomerRetrievalPort;
import com.rbs.bdd.application.port.in.PaymentValidationPort;
import com.rbsg.soa.c040paymentmanagement.customerretrievalforpayment.v01.serviceparameters.v01.RetrievePrimaryCustomerForArrRequest;
import com.rbsg.soa.c040paymentmanagement.arrvalidationforpayment.v01.ValidateArrangementForPaymentRequest;
import org.springframework.ws.WebServiceMessage;
import org.springframework.ws.context.MessageContext;
import org.springframework.ws.server.endpoint.annotation.Endpoint;
import org.springframework.ws.server.endpoint.annotation.PayloadRoot;
import org.springframework.ws.server.endpoint.annotation.RequestPayload;
import org.springframework.ws.server.endpoint.annotation.ResponsePayload;


/**
 * SOAP endpoint adapter class for handling the `validateArrangementForPayment` operation.
 * It uses Spring WS annotations to route incoming SOAP requests to the appropriate service layer.
 */
@Endpoint
public class PaymentValidationSoapAdapter {

    /**Changes for the request*/

    private static final String NAMESPACE_URI_FOR_ACCOUNT_VALIDATION = "http://com/rbsg/soa/C040PaymentManagement/ArrValidationForPayment/V01/";
    private static final String NAMESPACE_URI_FOR_CUSTOMER_RETRIEVAL = "http://com/rbsg/soa/C040PaymentManagement/CustomerRetrievalForPayment/V01/ServiceParameters/V01/";

    private final PaymentValidationPort paymentValidationPort;
    private final CustomerRetrievalPort customerRetrievalPort;

    /**
     * Constructor-based injection of the orchestrator that handles business logic.
     *
     * @param paymentValidationPort the orchestrator service
     */
    public PaymentValidationSoapAdapter(PaymentValidationPort paymentValidationPort,CustomerRetrievalPort customerRetrievalPort) {
        this.paymentValidationPort = paymentValidationPort;
        this.customerRetrievalPort = customerRetrievalPort;
    }



    /**
     * Handles the `validateArrangementForPayment` SOAP request.
     * Delegates request processing to the orchestrator which modifies the response message directly.
     *
     * @param request the SOAP request payload
     * @param context the Spring WS message context
     */
    @PayloadRoot(namespace = NAMESPACE_URI_FOR_ACCOUNT_VALIDATION, localPart = "validateArrangementForPayment")
    @ResponsePayload
    public void validateArrangementForPayment(@RequestPayload ValidateArrangementForPaymentRequest request,
                                                MessageContext context) {

        WebServiceMessage response = context.getResponse();
        paymentValidationPort.validateArrangementForPayment(request, response);
         }

    /**
     * Handles the `RetrieveCustomerRequest` SOAP request.
     * Delegates request processing to the orchestrator which modifies the response message directly.
     *
     * @param request the SOAP request payload
     * @param context the Spring WS message context
     */
    @PayloadRoot(namespace = NAMESPACE_URI_FOR_CUSTOMER_RETRIEVAL, localPart = "retrievePrimaryCustomerForArr")
    @ResponsePayload
    public void validateCustomerRetrieval(@RequestPayload RetrievePrimaryCustomerForArrRequest request,
                                              MessageContext context) {
        System.out.println("Reached here in customer");
        WebServiceMessage response = context.getResponse();

        customerRetrievalPort.validateCustomerRetrieval(request, response);
    }

}

------------------------

<?xml version="1.0" encoding="UTF-8"?><wsdl:definitions xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/" name="CustomerRetrievalForPayment" targetNamespace="http://com/rbsg/soa/C040PaymentManagement/CustomerRetrievalForPayment/V01/" xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/" xmlns:tns="http://com/rbsg/soa/C040PaymentManagement/CustomerRetrievalForPayment/V01/" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <wsdl:documentation>[generationDate='2021-03-25 05:32:21 PM']
[generator info ='rbs.transformation.extension.uml2wsdlxsd,0.9.0.18']</wsdl:documentation>
  <wsdl:types>
    <xsd:schema targetNamespace="http://com/rbsg/soa/C040PaymentManagement/CustomerRetrievalForPayment/V01/" xmlns:crfpSP="http://com/rbsg/soa/C040PaymentManagement/CustomerRetrievalForPayment/V01/ServiceParameters/V01/">
      <xsd:import namespace="http://com/rbsg/soa/C040PaymentManagement/CustomerRetrievalForPayment/V01/ServiceParameters/V01/" schemaLocation="CustomerRetrievalForPaymentParameters.xsd"/>
      <xsd:element name="retrievePrimaryCustomerForArr" type="crfpSP:retrievePrimaryCustomerForArrRequest"/>
      <xsd:element name="retrievePrimaryCustomerForArrResponse" type="crfpSP:retrievePrimaryCustomerForArrResponse"/>
    </xsd:schema>
  </wsdl:types>
  <wsdl:message name="retrievePrimaryCustomerForArrRequest">
    <wsdl:part element="tns:retrievePrimaryCustomerForArr" name="parameters"/>
  </wsdl:message>
  <wsdl:message name="retrievePrimaryCustomerForArrResponse">
    <wsdl:part element="tns:retrievePrimaryCustomerForArrResponse" name="parameters"/>
  </wsdl:message>
  <wsdl:portType name="ICustomerRetrievalForPayment">
    <wsdl:documentation>This service encompasses the operations required to retrieve a core set of information about a Customer in order to validate a Payment. The current scope of usage is retrieval for use in Payment Processing only. </wsdl:documentation>
    <wsdl:operation name="retrievePrimaryCustomerForArr">
      <wsdl:documentation>This operation enables the retrieval of the Primary or Owning Customer (Personal or Non Personal) of an Account (Domestic or International).  Returns limited party and address details. The current scope of usage is retrieval for use in Payment Processing only. </wsdl:documentation>
      <wsdl:input message="tns:retrievePrimaryCustomerForArrRequest"/>
      <wsdl:output message="tns:retrievePrimaryCustomerForArrResponse"/>
    </wsdl:operation>
  </wsdl:portType>
  <wsdl:binding name="ICustomerRetrievalForPaymentJMSBinding" type="tns:ICustomerRetrievalForPayment">
    <soap:binding transport="http://schemas.xmlsoap.org/soap/jms"/>
    <wsdl:operation name="retrievePrimaryCustomerForArr">
      <soap:operation soapAction="http://com/rbsg/soa/C040PaymentManagement/CustomerRetrievalForPayment/V01/retrievePrimaryCustomerForArr/"/>
      <wsdl:input>
        <soap:body parts="parameters" use="literal"/>
      </wsdl:input>
      <wsdl:output>
        <soap:body parts="parameters" use="literal"/>
      </wsdl:output>
    </wsdl:operation>
  </wsdl:binding>
  <wsdl:binding name="ICustomerRetrievalForPaymentHTTPBinding" type="tns:ICustomerRetrievalForPayment">
    <soap:binding transport="http://schemas.xmlsoap.org/soap/http"/>
    <wsdl:operation name="retrievePrimaryCustomerForArr">
      <soap:operation soapAction="http://com/rbsg/soa/C040PaymentManagement/CustomerRetrievalForPayment/V01/retrievePrimaryCustomerForArr/"/>
      <wsdl:input>
        <soap:body parts="parameters" use="literal"/>
      </wsdl:input>
      <wsdl:output>
        <soap:body parts="parameters" use="literal"/>
      </wsdl:output>
    </wsdl:operation>
  </wsdl:binding>
  <wsdl:service name="CustomerRetrievalForPayment">
    <wsdl:documentation>This service encompasses the operations required to retrieve a core set of information about a Customer in order to validate a Payment. The current scope of usage is retrieval for use in Payment Processing only. 
[serviceVersion='ALL_20210325_Baseline']</wsdl:documentation>
    <wsdl:port binding="tns:ICustomerRetrievalForPaymentJMSBinding" name="CUSTFORPAYMT040_01.ALL.X_D_H">
      <soap:address location="dpmq:/CUSTFORPAYMT040_01_FSH?RequestQueue=CUSTFORPAYMT040_01.ALL.X_D.REQ;ReplyQueue=CUSTFORPAYMT040_01.ALL.D_X.RESP"/>
    </wsdl:port>
    <wsdl:port binding="tns:ICustomerRetrievalForPaymentHTTPBinding" name="ICustomerRetrievalForPaymentPortHTTP_ALL_X">
      <soap:address location="http://0.0.0.0:3001/ALL/CUSTFORPAYMT040/01"/>
    </wsdl:port>
  </wsdl:service>
</wsdl:definitions>


------------------------


Error :-

BeanPostProcessor declaration and its dependencies/advisors. If this bean does not have to be post-processed, declare it with ROLE_INFRASTRUCTURE.
2025-06-12T09:30:01.804+01:00  INFO 21908 --- [  restartedMain] .w.s.a.s.AnnotationActionEndpointMapping : Supporting [WS-Addressing August 2004, WS-Addressing 1.0]
2025-06-12T09:30:02.553+01:00  INFO 21908 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-06-12T09:30:02.583+01:00  INFO 21908 --- [  restartedMain] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-06-12T09:30:02.583+01:00  INFO 21908 --- [  restartedMain] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.40]
2025-06-12T09:30:02.689+01:00  INFO 21908 --- [  restartedMain] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-06-12T09:30:02.690+01:00  INFO 21908 --- [  restartedMain] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 4749 ms
Here
2025-06-12T09:30:04.815+01:00  INFO 21908 --- [  restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729
2025-06-12T09:30:04.832+01:00  INFO 21908 --- [  restartedMain] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 1 endpoint beneath base path '/actuator'
2025-06-12T09:30:05.009+01:00  INFO 21908 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-06-12T09:30:05.033+01:00  INFO 21908 --- [  restartedMain] com.rbs.bdd.EspSimulatorEngine           : Started EspSimulatorEngine in 8.375 seconds (process running for 9.31)
2025-06-12T09:30:28.541+01:00  INFO 21908 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring MessageDispatcherServlet 'messageDispatcherServlet'
2025-06-12T09:30:28.542+01:00  INFO 21908 --- [nio-8080-exec-1] o.s.w.t.http.MessageDispatcherServlet    : Initializing Servlet 'messageDispatcherServlet'
2025-06-12T09:30:28.581+01:00  INFO 21908 --- [nio-8080-exec-1] o.s.ws.soap.saaj.SaajSoapMessageFactory  : Creating SAAJ 1.3 MessageFactory with SOAP 1.1 Protocol
2025-06-12T09:30:28.667+01:00  INFO 21908 --- [nio-8080-exec-1] o.s.w.t.http.MessageDispatcherServlet    : Completed initialization in 125 ms
2025-06-12T09:30:29.040+01:00  WARN 21908 --- [nio-8080-exec-1] o.s.ws.server.EndpointNotFound           : No endpoint mapping found for [SaajSoapMessage {http://com/rbsg/soa/C040PaymentManagement/CustomerRetrievalForPayment/V01/}retrievePrimaryCustomerForArr]



