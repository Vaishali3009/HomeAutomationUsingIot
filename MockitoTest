+---------------------------------------------+
|         SOAP Request (WSDL/XSD)             |
+---------------------------------------------+
                     |
              [Soap Adapter]
                     |
                     v
        +-----------------------------+
        | PaymentValidationPort       |<--------------------+
        +-----------------------------+                     |
                     |                                      |
        +-----------------------------+                     |
        | PaymentOrchestrator         |                     |
        +-----------------------------+                     |
                     |                                      |
        +-----------------------------+                     |
        | AccountValidationPort       |                     |
        +-----------------------------+                     |
                                                            |
        +-----------------------------+                     |
        | CustomerRetrievalPort       |<------------------+ |
        +-----------------------------+                   | |
                     |                                    | |
        +-----------------------------+                   | |
        | CustomerRetrievalOrchestrator|                  | |
        +-----------------------------+                   | |
                     |                                    | |
        +-----------------------------+                   | |
        | CustomerRetrievalService     |                  | |
        +-----------------------------+                   | |
                                                          | |
        +-------------------------------------------------+ |
        |     All logic flows through Soap Adapter â†’      | |
        |     appropriate Port â†’ Orchestrator â†’ Service    |<+
        +--------------------------------------------------+


ESP Simulation Service â€“ Spring Boot SOAP Microservice

ðŸ“˜ Overview

This project simulates an ESP (Electronic Service Provider) backend using Spring Boot, Spring WS, and SOAP Web Services. It supports two key operations:
	â€¢	Account Validation
	â€¢	Customer Retrieval

Each operation is implemented using SOAP with schema validation (XSD), static response XML transformation, and dynamic field updates using DOM/XPath.

â¸»

ðŸ“¦ Modules & Structure

com.rbs.bdd
â”œâ”€â”€ application
â”‚   â”œâ”€â”€ exception                 # Custom exception classes
â”‚   â”œâ”€â”€ port.in                  # Interfaces for input (SOAP Adapter)
â”‚   â”œâ”€â”€ port.out                 # Interfaces for output (Service layer)
â”‚   â””â”€â”€ service                  # Business logic for account validation and customer retrieval
â”œâ”€â”€ domain
â”‚   â””â”€â”€ enums                    # Enums and constants (e.g., namespaces, paths, error codes)
â”œâ”€â”€ infrastructure
â”‚   â”œâ”€â”€ config                   # Spring WS configuration
â”‚   â”œâ”€â”€ entity                   # JPA Entity classes
â”‚   â”œâ”€â”€ repository               # Spring Data JPA repositories
â”‚   â””â”€â”€ soap
â”‚       â”œâ”€â”€ adapter              # SOAP endpoint adapter
â”‚       â””â”€â”€ interceptor          # Interceptors for schema validation and custom SOAP faults
â”œâ”€â”€ util                         # Utility classes for DOM manipulation, XPath, validation
â”œâ”€â”€ static-response              # Contains static success and error SOAP XML responses
â””â”€â”€ static-request               # Contains sample SOAP request XMLs for testing

Features
	â€¢	âœ… SOAP Operations
	â€¢	/validateArrangementForPayment for account validation
	â€¢	/retrievePrimaryCustomerForArr for customer retrieval
	â€¢	ðŸ§ª Schema Validation
	â€¢	Custom PayloadValidatingInterceptor per namespace
	â€¢	Handles schema errors and malformed XML
	â€¢	ðŸ§  Business Rule Engine
	â€¢	Validates IBAN and UBAN formats, lengths, MOD97 checksum
	â€¢	Returns static success or error responses based on request content
	â€¢	ðŸ”„ Static XML Response Handling
	â€¢	Reads response templates from /static-response/
	â€¢	Modifies transactionId, timestamp, description, etc. using DOM/XPath
	â€¢	ðŸ§ª JUnit Test Coverage
	â€¢	Full test coverage for:
	â€¢	Account validation logic
	â€¢	Customer retrieval logic
	â€¢	Interceptors
	â€¢	SOAP adapter routing

â¸»

ðŸ”§ Technologies Used
	â€¢	Java 17+
	â€¢	Spring Boot 3
	â€¢	Spring WS
	â€¢	SOAP (WSDL/XSD)
	â€¢	JAXB
	â€¢	XPath / DOM Parser
	â€¢	JUnit 5 & Mockito
	â€¢	PostgreSQL (for customer data persistence)
	â€¢	Maven

â¸»

ðŸ§¬ Schema and WSDL

Schemas are located under:

src/main/resources/xsd/
â”œâ”€â”€ account-validation/
â”‚   â””â”€â”€ ArrValidationForPaymentParameters.xsd
â”œâ”€â”€ customer-retrieval/
â”‚   â””â”€â”€ CustomerRetrievalForPaymentParameters.xsd
â””â”€â”€ shared/
    â”œâ”€â”€ PrimitiveDatatypes.xsd
    â””â”€â”€ ServiceDefinitions.xsd

WSDLs are dynamically published at:
	â€¢	/ws/ArrValidationForPaymentParameters.wsdl
	â€¢	/ws/CustomerRetrievalForPayment.wsdl

â¸»

ðŸ§ª Running Tests

Test classes are located under src/test/java:
	â€¢	AccountValidationServiceTest
	â€¢	CustomerRetrievalServiceTest
	â€¢	PaymentValidationSoapAdapterTest
	â€¢	AccountSchemaValidationInterceptorTest
	â€¢	CustomerRetrievalSchemaValidationInterceptorTest



Run
mvn clean test


To generate test coverage (Jacoco integrated):
mvn clean verify


Static Files
	â€¢	static-request/*.xml â€“ Sample SOAP request payloads
	â€¢	static-response/*.xml â€“ Response templates
	â€¢	Responses are updated dynamically using DOM and XPath before being returned.


Notable Design Highlights
	â€¢	âœ… Hexagonal Architecture for clean separation of adapters, ports, and core logic
	â€¢	âœ… Dynamic field injection in static SOAP responses
	â€¢	âœ… Multiple interceptors registered via Spring WS WsConfigurerAdapter
	â€¢	âœ… JAXB + DOM Parser for robust XML handling
	â€¢	âœ… Graceful fallback logic for unmatched accounts using static error templates
	â€¢	âœ… UUID-based transaction ID generation
	â€¢	âœ… Selective tag removal (<systemId>, <transactionId>, <refRequestIds>) based on request

Test Scenarios Covered
	â€¢	âœ” Valid IBAN returns expected customer data
	â€¢	âœ” GB-prefixed UBAN returns ERR_UBAN_GB
	â€¢	âœ” UBAN length < 14 triggers error
	â€¢	âœ” Unmatched UBAN/IBAN results in â€œUnable to Complete Requestâ€
	â€¢	âœ” Schema validation failure returns custom SOAP error
	â€¢	âœ” Malformed XML returns Spring WS fault (500)
	â€¢	âœ” Interceptors dynamically inject transactionId, timestamp

â¸»

ðŸ§  Contributors Notes
	â€¢	Modify enum values in ValidationErrorType, ErrorConstants to extend rules.
	â€¢	Update error templates in /static-response/error-response.xml to reflect additional metadata.
	â€¢	DB lookup for customer data is done via CustomerRepository.findByAccountNo(...).
	â€¢	Add new business logic under AccountValidationService or CustomerRetrievalService.

â¸»

ðŸ Sample Request Payload (Account Validation)

<validateArrangementForPayment xmlns="http://com/rbsg/soa/C040PaymentManagement/ArrValidationForPayment/V01/">
  <arrangementIdentifier>
    <identifier>GB29NWBK60161331926801</identifier>
    <codeValue>InternationalBankAccountNumber</codeValue>
  </arrangementIdentifier>
  <requestIds>
    <transactionId>ESP-TXN-123</transactionId>
    <systemId>ESP</systemId>
  </requestIds>
</validateArrangementForPayment>
